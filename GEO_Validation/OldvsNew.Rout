
R version 3.3.3 (2017-03-06) -- "Another Canoe"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin13.4.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> options(echo=T)
> options(digits=6)
> # setwd("/Users/afaranda/Documents/GEO_Submission/GSE111430_RAW")
> a<-read.table(
+ 	"../GeneCount.tsv",
+ 	header=T, quote="", sep='\t',
+ 	stringsAsFactors=F
+ )
> 
> b<-read.table(
+         "../GeneCount.ReCalcRPKM.tsv",
+         header=T, quote="", sep='\t',
+         stringsAsFactors=F
+ )
> 
> files<-list.files(pattern="tab.txt$")
> 
> compare<-function(f=files, all=a){
+ 	for ( i in f ) {
+ 		s<-gsub(".tab.txt","", gsub("GSM303064[4|5|6|7|8|9]_","",i))
+ 		df<-read.table( i, header=T, quote="", sep='\t', stringsAsFactors=F)
+ 		
+ 		dup<-unique(
+ 			c(
+ 				unique(with(all, all[duplicated(GeneID), 'GeneID'])),
+ 				unique(with(df, df[duplicated(GeneID), 'GeneID']))
+ 			)
+ 		)
+ 		
+ 		names(df)<-gsub("S6_GeneCount$", "S6_GeneCount.raw", names(df))
+ 		print(names(df))
+ 		dfc<-c('GeneID', 
+ 			paste(s,'_GeneCount.raw', sep=''), 
+ 			paste(s,'_GeneCount.rpkm', sep='')
+ 		)
+ 		
+ 		allc<-c(
+ 			'GeneID', 
+ 			paste(s,'_GeneCount', sep=''), 
+ 			paste(s,'_RPKM', sep='')
+ 		)
+ 		
+ 		# Most GeneID are unique -- limit check to those
+ 		check<-merge(
+ 			df[!(df$GeneID %in% dup), dfc],
+ 			all[!(all$GeneID %in% dup), allc],
+ 			by='GeneID'
+ 		)
+ 		check
+ 		check$countDiff<-check[,dfc[2]] - check[,allc[2]]
+ 		check$rpkmDiff<-round(check[,dfc[3]],9) - round(check[,allc[3]], 9)
+ 		
+ 		ord<-c(
+ 			"GeneID",
+ 			allc[2],
+ 			dfc[2],
+ 			'countDiff',
+ 			allc[3],
+ 			dfc[3],
+ 			'rpkmDiff'
+ 		)
+ 		
+ 		print(head(check[,ord]))
+ 		print(paste("Sum, countDiff:", sum(abs(check$countDiff))))
+ 		print(paste("Sum, rpkmDiff:", sum(abs(check$rpkmDiff))))
+ 	}
+ }
> 
> compare(files, all=a)
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S1_GeneCount.cpm"  "S1_GeneCount.rpkm"
[7] "S1_GeneCount.raw" 
         GeneID S1_GeneCount S1_GeneCount.raw countDiff    S1_RPKM
1 0610005C13Rik            1                1         0  0.0719831
2 0610007P14Rik          347              347         0 23.6501748
3 0610009B22Rik          126              126         0 12.8004915
4 0610009L18Rik           16               16         0  2.0876254
5 0610009O20Rik          540              540         0 18.1418899
6 0610010B08Rik           10               10         0  0.0296614
  S1_GeneCount.rpkm   rpkmDiff
1         0.0918192 0.01983611
2        30.1673675 6.51719273
3        16.3278765 3.52738494
4         2.6629047 0.57527933
5        23.1411846 4.99929468
6         0.0378351 0.00817368
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 96157.898189229"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S2_GeneCount.cpm"  "S2_GeneCount.rpkm"
[7] "S2_GeneCount.raw" 
         GeneID S2_GeneCount S2_GeneCount.raw countDiff   S2_RPKM
1 0610005C13Rik            6                6         0  0.391012
2 0610007P14Rik          253              253         0 15.611096
3 0610009B22Rik           96               96         0  8.829484
4 0610009L18Rik           20               20         0  2.362493
5 0610009O20Rik          555              555         0 16.880672
6 0610010B08Rik           40               40         0  0.107414
  S2_GeneCount.rpkm  rpkmDiff
1          0.568862 0.1778504
2         22.711753 7.1006574
3         12.845547 4.0160628
4          3.437066 1.0745725
5         24.558793 7.6781202
6          0.156270 0.0488568
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 127641.007080465"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S3_GeneCount.cpm"  "S3_GeneCount.rpkm"
[7] "S3_GeneCount.raw" 
         GeneID S3_GeneCount S3_GeneCount.raw countDiff    S3_RPKM
1 0610005C13Rik            6                6         0  0.4302656
2 0610007P14Rik          295              295         0 20.0300443
3 0610009B22Rik           88               88         0  8.9062275
4 0610009L18Rik           16               16         0  2.0797330
5 0610009O20Rik          472              472         0 15.7974060
6 0610010B08Rik           18               18         0  0.0531887
  S3_GeneCount.rpkm  rpkmDiff
1         0.6122096 0.1819440
2        28.5000374 8.4699931
3        12.6723543 3.7661268
4         2.9591781 0.8794451
5        22.4775669 6.6801610
6         0.0756803 0.0224916
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 125746.379424756"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S4_GeneCount.cpm"  "S4_GeneCount.rpkm"
[7] "S4_GeneCount.raw" 
         GeneID S4_GeneCount S4_GeneCount.raw countDiff    S4_RPKM
1 0610005C13Rik            0                0         0  0.0000000
2 0610007P14Rik          247              247         0 16.9871707
3 0610009B22Rik           53               53         0  5.4331437
4 0610009L18Rik            5                5         0  0.6582969
5 0610009O20Rik          372              372         0 12.6110406
6 0610010B08Rik           13               13         0  0.0389094
  S4_GeneCount.rpkm rpkmDiff
1         0.0000000 0.000000
2        25.8310457 8.843875
3         8.2617515 2.828608
4         1.0010200 0.342723
5        19.1766111 6.565571
6         0.0591664 0.020257
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 128701.157178654"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S5_GeneCount.cpm"  "S5_GeneCount.rpkm"
[7] "S5_GeneCount.raw" 
         GeneID S5_GeneCount S5_GeneCount.raw countDiff    S5_RPKM
1 0610005C13Rik            0                0         0  0.0000000
2 0610007P14Rik          276              276         0 18.3823932
3 0610009B22Rik           61               61         0  6.0558349
4 0610009L18Rik            5                5         0  0.6375154
5 0610009O20Rik          431              431         0 14.1499246
6 0610010B08Rik           10               10         0  0.0289854
  S5_GeneCount.rpkm  rpkmDiff
1         0.0000000 0.0000000
2        27.0336979 8.6513047
3         8.9058921 2.8500572
4         0.9375492 0.3000338
5        20.8093029 6.6593782
6         0.0426268 0.0136414
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 131043.464222137"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S6_GeneCount.cpm"  "S6_GeneCount.rpkm"
[7] "S6_GeneCount.raw" 
         GeneID S6_GeneCount S6_GeneCount.raw countDiff    S6_RPKM
1 0610005C13Rik            2                2         0  0.1472360
2 0610007P14Rik          352              352         0 24.5358524
3 0610009B22Rik           76               76         0  7.8962938
4 0610009L18Rik            2                2         0  0.2668801
5 0610009O20Rik          483              483         0 16.5954680
6 0610010B08Rik            7                7         0  0.0212346
  S6_GeneCount.rpkm   rpkmDiff
1         0.1927217 0.04548575
2        32.1157367 7.57988428
3        10.3357034 2.43940958
4         0.3493276 0.08244752
5        21.7223218 5.12685376
6         0.0277946 0.00656001
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 96437.781653921"
> compare(files, all=b)
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S1_GeneCount.cpm"  "S1_GeneCount.rpkm"
[7] "S1_GeneCount.raw" 
         GeneID S1_GeneCount S1_GeneCount.raw countDiff    S1_RPKM
1 0610005C13Rik            1                1         0  0.0918192
2 0610007P14Rik          347              347         0 30.1673675
3 0610009B22Rik          126              126         0 16.3278765
4 0610009L18Rik           16               16         0  2.6629047
5 0610009O20Rik          540              540         0 23.1411846
6 0610010B08Rik           10               10         0  0.0378351
  S1_GeneCount.rpkm rpkmDiff
1         0.0918192    0e+00
2        30.1673675   -5e-09
3        16.3278765    0e+00
4         2.6629047    0e+00
5        23.1411846    4e-09
6         0.0378351    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.5067991191795e-05"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S2_GeneCount.cpm"  "S2_GeneCount.rpkm"
[7] "S2_GeneCount.raw" 
         GeneID S2_GeneCount S2_GeneCount.raw countDiff   S2_RPKM
1 0610005C13Rik            6                6         0  0.568862
2 0610007P14Rik          253              253         0 22.711753
3 0610009B22Rik           96               96         0 12.845547
4 0610009L18Rik           20               20         0  3.437066
5 0610009O20Rik          555              555         0 24.558793
6 0610010B08Rik           40               40         0  0.156270
  S2_GeneCount.rpkm rpkmDiff
1          0.568862    0e+00
2         22.711753    2e-09
3         12.845547    5e-09
4          3.437066    0e+00
5         24.558793    1e-09
6          0.156270    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.2131005058389e-05"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S3_GeneCount.cpm"  "S3_GeneCount.rpkm"
[7] "S3_GeneCount.raw" 
         GeneID S3_GeneCount S3_GeneCount.raw countDiff    S3_RPKM
1 0610005C13Rik            6                6         0  0.6122096
2 0610007P14Rik          295              295         0 28.5000374
3 0610009B22Rik           88               88         0 12.6723543
4 0610009L18Rik           16               16         0  2.9591781
5 0610009O20Rik          472              472         0 22.4775669
6 0610010B08Rik           18               18         0  0.0756803
  S3_GeneCount.rpkm rpkmDiff
1         0.6122096    0e+00
2        28.5000374    1e-09
3        12.6723543   -3e-09
4         2.9591781    0e+00
5        22.4775669   -4e-09
6         0.0756803    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.5863004052672e-05"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S4_GeneCount.cpm"  "S4_GeneCount.rpkm"
[7] "S4_GeneCount.raw" 
         GeneID S4_GeneCount S4_GeneCount.raw countDiff    S4_RPKM
1 0610005C13Rik            0                0         0  0.0000000
2 0610007P14Rik          247              247         0 25.8310457
3 0610009B22Rik           53               53         0  8.2617515
4 0610009L18Rik            5                5         0  1.0010200
5 0610009O20Rik          372              372         0 19.1766111
6 0610010B08Rik           13               13         0  0.0591664
  S4_GeneCount.rpkm rpkmDiff
1         0.0000000    0e+00
2        25.8310457   -3e-09
3         8.2617515    0e+00
4         1.0010200    0e+00
5        19.1766111    0e+00
6         0.0591664    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.63070029827384e-05"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S5_GeneCount.cpm"  "S5_GeneCount.rpkm"
[7] "S5_GeneCount.raw" 
         GeneID S5_GeneCount S5_GeneCount.raw countDiff    S5_RPKM
1 0610005C13Rik            0                0         0  0.0000000
2 0610007P14Rik          276              276         0 27.0336979
3 0610009B22Rik           61               61         0  8.9058921
4 0610009L18Rik            5                5         0  0.9375492
5 0610009O20Rik          431              431         0 20.8093029
6 0610010B08Rik           10               10         0  0.0426268
  S5_GeneCount.rpkm rpkmDiff
1         0.0000000    0e+00
2        27.0336979   -4e-09
3         8.9058921    0e+00
4         0.9375492    0e+00
5        20.8093029   -3e-09
6         0.0426268    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.69250042666636e-05"
[1] "GeneID"            "ensembl_gene_id"   "description"      
[4] "chromosome_name"   "S6_GeneCount.cpm"  "S6_GeneCount.rpkm"
[7] "S6_GeneCount.raw" 
         GeneID S6_GeneCount S6_GeneCount.raw countDiff    S6_RPKM
1 0610005C13Rik            2                2         0  0.1927217
2 0610007P14Rik          352              352         0 32.1157367
3 0610009B22Rik           76               76         0 10.3357034
4 0610009L18Rik            2                2         0  0.3493276
5 0610009O20Rik          483              483         0 21.7223218
6 0610010B08Rik            7                7         0  0.0277946
  S6_GeneCount.rpkm rpkmDiff
1         0.1927217    0e+00
2        32.1157367    3e-09
3        10.3357034    0e+00
4         0.3493276    0e+00
5        21.7223218    4e-09
6         0.0277946    0e+00
[1] "Sum, countDiff: 0"
[1] "Sum, rpkmDiff: 3.40539969716502e-05"
> 
> proc.time()
   user  system elapsed 
  9.577   0.117   9.807 
